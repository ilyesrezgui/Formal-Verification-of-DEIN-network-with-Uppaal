<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.6//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_6.dtd'>
<nta>
	<declaration>int ES=3; // the enrgy of the signal transmitted/recieved
const int N=3;
typedef int[0,N-1] id_wd;


broadcast chan HAP2WD;
id_wd id_sender;
chan Send_Data, Data_Sent, WD2HAP_REQ[N];

</declaration>
	<template>
		<name x="5" y="5">HAP</name>
		<declaration>int id_sender=0;

const int N=3;
typedef int[0,N-1] id_wd;



</declaration>
		<location id="id0" x="-93" y="-25">
			<name x="-103" y="-59">Idle</name>
		</location>
		<location id="id1" x="467" y="-59">
			<name x="493" y="-68">SignalTransmission</name>
		</location>
		<location id="id2" x="-272" y="-323">
			<name x="-282" y="-357">DataReception</name>
		</location>
		<init ref="id0"/>
		<transition id="id3">
			<source ref="id2"/>
			<target ref="id0"/>
			<label kind="synchronisation" x="-408" y="-187">Data_Sent!</label>
			<nail x="-357" y="-34"/>
			<nail x="-357" y="-34"/>
		</transition>
		<transition id="id4">
			<source ref="id0"/>
			<target ref="id2"/>
			<label kind="synchronisation" x="-212" y="-255">Send_Data?</label>
		</transition>
		<transition id="id5">
			<source ref="id1"/>
			<target ref="id0"/>
			<label kind="synchronisation" x="119" y="-68">HAP2WD!</label>
		</transition>
		<transition id="id6">
			<source ref="id0"/>
			<target ref="id1"/>
			<label kind="select" x="-68" y="-212">id:id_wd</label>
			<label kind="synchronisation" x="-68" y="-195">WD2HAP_REQ[id]?</label>
			<label kind="assignment" x="-68" y="-178">id_sender=id</label>
			<nail x="136" y="-212"/>
		</transition>
	</template>
	<template>
		<name>WD</name>
		<parameter>const id_wd id,int distance</parameter>
		<declaration>int Epack=1;  //energy needed to send data from WD to Hap the data, depends from the type of WD and from the length of the data packet.
// for the experimenetation we fix the data packet length for 22  bits. 
// Epack is between  50 and 150 joules/bit thereforre we can experiment with different WD as if their Epack varies in this interval. https://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=926982&amp;casa_token=CY91gfh4z3QAAAAA:LwHXMRRpp1FtJKmkkgocV5xEL4IQnJpWJReicFjICJNgINxauj1WHDSbmmReYVPAjwCt8KnMutFO0bs
int nbbit=22; // represents the number of bits for a message. Article : Create Your Own Data and Energy Integrated Communication Network: A Brief Tutorial and a  Prototype System

double EWD=0; // represnts the capacity of super capacitator : when sending a packet EWD=EWD-(nbbit*Epack)
int Energy_Harvested=1; //The percentage of energy to harvest if you're the requester.
bool W2H_Request=false;  
int capacity=10; // max capacity of super capacitator between 10 and 150
// you can add an int representing the distance %  au HAP, to model the impact of ditance per each WD
// try to look for the correct formula to calculate the energy harvested based on the distance with WD.
// the buggesr the sitance the less energy is harvested
//int Elost=0;

double verif_capacity(double x,double y){
x=x*(3*3.14*distance)*(3*3.14*distance); 

if (x+y&gt; capacity){
        return capacity;    
    }
    else {
        return x+y;}
}
//int energylost(int x, int y){
    //return Elost=Elost+(x+y-capacity); 
//}





// RF Energy Harvesting J Szut, P PiÄ…tek, M Pauluk - Energies, 2024 - mdpi.com
</declaration>
		<location id="id7" x="-204" y="34">
			<name x="-221" y="51">Idle</name>
		</location>
		<location id="id8" x="289" y="42">
			<name x="306" y="34">SignalReception</name>
		</location>
		<location id="id9" x="-527" y="-187">
			<name x="-578" y="-221">DataTransmission</name>
		</location>
		<init ref="id7"/>
		<transition id="id10">
			<source ref="id9"/>
			<target ref="id7"/>
			<label kind="synchronisation" x="-620" y="-17">Data_Sent?</label>
			<nail x="-527" y="76"/>
			<nail x="-527" y="76"/>
		</transition>
		<transition id="id11">
			<source ref="id7"/>
			<target ref="id9"/>
			<label kind="guard" x="-408" y="-161">EWD-Epack&gt;=0</label>
			<label kind="synchronisation" x="-408" y="-145">Send_Data!</label>
			<label kind="assignment" x="-408" y="-127">EWD=EWD-Epack</label>
		</transition>
		<transition id="id12">
			<source ref="id7"/>
			<target ref="id7"/>
			<label kind="guard" x="-365" y="127">id!=id_sender</label>
			<label kind="synchronisation" x="-323" y="144">HAP2WD?</label>
			<label kind="assignment" x="-467" y="161">EWD=verif_capacity(ES,EWD)</label>
			<nail x="-272" y="85"/>
			<nail x="-212" y="170"/>
			<nail x="-144" y="119"/>
			<nail x="-161" y="59"/>
		</transition>
		<transition id="id13">
			<source ref="id8"/>
			<target ref="id7"/>
			<label kind="guard" x="-119" y="-136">id==id_sender</label>
			<label kind="synchronisation" x="-119" y="-153">HAP2WD?</label>
			<label kind="assignment" x="-119" y="-195">EWD=verif_capacity(Energy_Harvested,EWD),
W2H_Request=false</label>
			<nail x="34" y="-144"/>
			<nail x="-170" y="8"/>
		</transition>
		<transition id="id14">
			<source ref="id7"/>
			<target ref="id8"/>
			<label kind="synchronisation" x="-17" y="42">WD2HAP_REQ[id]!</label>
			<label kind="assignment" x="-17" y="59">W2H_Request=true,
id_sender=id</label>
		</transition>
	</template>
	<system>WD0=WD(0,25);
WD1=WD(1,20);
WD2=WD(2,35);
system WD1,WD0,WD2,HAP;
</system>
	<queries>
		<query>
			<formula/>
			<comment>===== Reachability:</comment>
		</query>
		<query>
			<formula>E&lt;&gt; WD0.SignalReception</formula>
			<comment>The SignalReception state can be reached eventually by WD0.</comment>
			<result outcome="success" type="quality" timestamp="2024-04-28 18:08:47 +0100">
			</result>
		</query>
		<query>
			<formula>E&lt;&gt; WD2.SignalReception</formula>
			<comment>The SignalReception state can be reached eventually by WD2.</comment>
			<result outcome="success" type="quality" timestamp="2024-04-28 18:08:51 +0100">
			</result>
		</query>
		<query>
			<formula>E&lt;&gt; WD1.SignalReception.</formula>
			<comment>The SignalReception state can be reached eventually by WD1.</comment>
		</query>
		<query>
			<formula/>
			<comment>===== Liveness Properties:
			</comment>
		</query>
		<query>
			<formula>HAP1.SignalTransmission --&gt; WD2.SignalReception or WD1.SignalReception or WD0.SignalReception
</formula>
			<comment>When a HAP is about transmitting a Signal, one of the WDs should eventually be recieving it.</comment>
		</query>
		<query>
			<formula>WD1.SignalReception --&gt; WD0.Idle and WD2.Idle</formula>
			<comment>One wireless device is receiving a signal at a time. in here WD1 is recieving.</comment>
			<result outcome="success" type="quality" timestamp="2024-04-29 16:00:31 +0100">
			</result>
		</query>
		<query>
			<formula>WD2.SignalReception --&gt; WD0.Idle and WD1.Idle</formula>
			<comment>One wirless device is recieving a signal at a time. in here WD2 is recieving.</comment>
			<result outcome="success" type="quality" timestamp="2024-04-29 16:00:51 +0100">
			</result>
		</query>
		<query>
			<formula/>
			<comment>===== Deadlock checking:</comment>
		</query>
		<query>
			<formula>A[] not deadlock</formula>
			<comment>No deadlocks at all</comment>
			<result outcome="success" type="quality" timestamp="2024-04-29 16:17:54 +0100">
			</result>
		</query>
		<query>
			<formula/>
			<comment>===== Safety Properties:</comment>
		</query>
		<query>
			<formula>A[] WD0.EWD&lt;=WD0.capacity</formula>
			<comment>The energy harvested by a WD should always be lower or equal than the capacity of the WD</comment>
			<result outcome="success" type="quality" timestamp="2024-04-29 16:07:28 +0100">
			</result>
		</query>
		<query>
			<formula>A[] WD1.EWD&lt;=WD1.capacity</formula>
			<comment>The energy harvested by a WD should always be lower or equal than the capacity of the WD</comment>
			<result outcome="success" type="quality" timestamp="2024-04-29 16:07:46 +0100">
			</result>
		</query>
		<query>
			<formula>A[] WD2.EWD&lt;=WD2.capacity</formula>
			<comment>The energy harvested by a WD should always be lower or equal than the capacity of the WD</comment>
			<result outcome="success" type="quality" timestamp="2024-04-29 16:07:55 +0100">
			</result>
		</query>
		<query>
			<formula>E&lt;&gt; not WD2.DataTransmission and (WD0.SignalReception or WD1.SignalReception)</formula>
			<comment>At some point in the future, WD2 is not in the state of DataTransmission, and at the same time, WD0 is in the state of SignalReception or WD1 is in the state of SignalReception.</comment>
			<result outcome="success" type="quality" timestamp="2024-04-29 22:07:31 +0100">
			</result>
		</query>
		<query>
			<formula>E&lt;&gt; not WD0.DataTransmission and (WD1.SignalReception or WD2.SignalReception)</formula>
			<comment/>
			<result outcome="success" type="quality" timestamp="2024-04-29 22:08:04 +0100">
			</result>
		</query>
		<query>
			<formula>E&lt;&gt; not WD1.DataTransmission and (WD0.SignalReception or WD2.SignalReception)</formula>
			<comment/>
			<result outcome="success" type="quality" timestamp="2024-04-29 22:08:15 +0100">
			</result>
		</query>
	</queries>
</nta>
